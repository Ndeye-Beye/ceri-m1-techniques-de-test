
  # Stacks detected: deps:java:.
  version: 2.1
  jobs:
    test-java:
      docker:
        - image: cimg/openjdk:17.0
      steps:
        - checkout
        - run:
            name: Calculate cache key
            command: |-
              find . -name 'pom.xml' -o -name 'gradlew*' -o -name '*.gradle*' | \
                      sort | xargs cat > /tmp/CIRCLECI_CACHE_KEY
        - restore_cache:
            key: cache-{{ checksum "/tmp/CIRCLECI_CACHE_KEY" }}
        - run:
            name: Run Tests with JaCoCo
            command: mvn clean verify
        - store_test_results:
            path: target/surefire-reports
        - run :
            name: Upload Coverage to Codecov
            cammand: bash <(curl -s https://codecov.io/bash) -t $CODECOV_TOKEN
        - save_cache:
            key: cache-{{ checksum "/tmp/CIRCLECI_CACHE_KEY" }}
            paths:
              - ~/.m2/repository
    deploy:
      docker:
        - image: cimg/base:stable
      steps:
        - run:
            name: deploy
            command: '#e.g. ./deploy.sh'
  workflows:
    build-and-test:
      jobs:
        - test-java :
            filters:
              branches:
                only: master


